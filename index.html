<!DOCTYPE html>
<html>
<head>
  <title>Mindfulness App (Sentiment Tracking)</title>
  <style>
    /* CSS (Mostly unchanged, added styles for new buttons and results section) */
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
      color: #333;
      line-height: 1.6;
    }

    h1, h2 {
        text-align: center;
        color: #5a5a5a;
    }

    #phase1, #phase2, #phase3, #results {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    input[type="text"], input[type="number"] {
      padding: 8px;
      margin-right: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      min-width: 250px; /* Give input more space */
    }

    button {
      padding: 8px 15px;
      background-color: #5c67f2; /* Default button blue */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 5px;
      margin-top: 5px;
    }

    button:hover {
      background-color: #4a54cc;
    }

     button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
    }

    /* Specific buttons for adding thoughts */
    .add-thought-btn-anxious {
        background-color: #dc3545; /* Red for anxious */
    }
    .add-thought-btn-anxious:hover {
        background-color: #c82333;
    }
     .add-thought-btn-calm {
        background-color: #28a745; /* Green for calm */
     }
      .add-thought-btn-calm:hover {
        background-color: #218838;
     }


    #thoughtList, #thoughtListPhase3 {
      list-style: none;
      padding: 0;
      margin-top: 15px; /* More space above list */
    }

    #thoughtList li, #thoughtListPhase3 li {
      margin-bottom: 8px;
      padding: 10px;
      background-color: #e9e9e9;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* Indicate sentiment visually in list - Optional */
     #thoughtList li.anxious, #thoughtListPhase3 li.anxious {
        border-left: 5px solid #dc3545; /* Red left border */
        padding-left: 10px;
     }
      #thoughtList li.calm, #thoughtListPhase3 li.calm {
        border-left: 5px solid #28a745; /* Green left border */
        padding-left: 10px;
     }


     #thoughtList li span.count, #thoughtListPhase3 li span.count {
        font-weight: bold;
        background-color: #5c67f2; /* Use default blue for count background */
        color: white;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 10px;
     }


    #thoughtList li:hover, #thoughtListPhase3 li:hover {
        background-color: #dcdcdc;
    }

    #timer, #timerPhase3, #breathworkTimer {
      font-size: 1.5em;
      font-weight: bold;
      text-align: center;
      margin: 10px 0;
      color: #5c67f2;
    }

    /* Results styling */
    #comparison {
        margin-top: 15px;
        padding: 10px;
        background-color: #e9f5ff;
        border: 1px solid #b3d7ff;
        border-radius: 5px;
    }
    #comparison table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    #comparison th, #comparison td {
        border: 1px solid #b3d7ff;
        padding: 8px;
        text-align: left;
    }
     #comparison th {
        background-color: #d1e7ff;
    }
    .decrease { color: green; font-weight: bold; } /* Change in count */
    .increase { color: red; font-weight: bold; }   /* Change in count */

    #sentimentAnalysis {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
    }
     #sentimentAnalysis h3 {
        margin-top: 0;
        text-align: center;
        color: #495057;
     }
     #sentimentAnalysis p {
        font-size: 1.1em;
        margin-bottom: 8px;
     }
      #sentimentAnalysis .sentiment-anxious { color: #dc3545; font-weight: bold; }
      #sentimentAnalysis .sentiment-calm { color: #28a745; font-weight: bold; }


    /* Basic flow control styling */
    .hidden {
        display: none;
    }

    /* Phase 2 Specific Styles */
     #breathworkGuide {
        margin-top: 15px;
        font-size: 1.4em;
        font-weight: bold;
        text-align: center;
        padding: 10px;
        background-color: #e9f5ff;
        border-radius: 5px;
        min-height: 30px;
     }
     #breathworkStatus {
        margin-top: 10px;
        text-align: center;
        font-size: 1.1em;
        color: #333;
     }
     #proceedToPhase3Button {
        background-color: #ffc107;
        color: #333;
        display: block;
        width: 80%;
        margin: 15px auto 0 auto;
     }
      #proceedToPhase3Button:hover {
        background-color: #e0a800;
     }


  </style>
</head>
<body>

  <h1>Mindfulness App</h1>

  <div id="phase1">
    <h2>Phase 1: Meditation (Observe Thoughts)</h2>
    <p>Sit comfortably, focus on your breath. When a thought arises, note it below (max 3 words) and click 'Add Anxious' or 'Add Calm'. If the thought repeats, click on its entry in the list below to count it.</p>
    <div>
      <label for="meditationDuration">Duration (minutes): </label>
      <input type="number" id="meditationDuration" value="2" min="1" max="60">
    </div>
    <div id="timer">00:00</div>
    <button id="startTimer">Start Phase 1</button>
    <button id="stopTimer" class="hidden">End Phase 1 & Proceed</button>
    <hr>
    <div>
        <input type="text" id="thoughtInput" placeholder="Enter thought (3 words max)" disabled>
        <button id="addAnxiousThought" class="add-thought-btn-anxious" disabled>Add Anxious</button>
        <button id="addCalmThought" class="add-thought-btn-calm" disabled>Add Calm</button>
    </div>
    <ul id="thoughtList"></ul>
  </div>

  <div id="phase2" class="hidden">
    <h2>Phase 2: Guided Breathwork</h2>
    <div id="breathworkOptions">
      <p>Choose a guided breathwork exercise below. You can stop at any time.</p>
      <button class="breathworkBtn" data-type="box">Start Box Breathing</button>
      <button class="breathworkBtn" data-type="478">Start 4-7-8 Breathing</button>
      <button id="skipBreathworkDirectly">Skip Breathwork Entirely</button>
    </div>
    <div id="breathworkActive" class="hidden">
        <div id="breathworkGuide">Ready...</div>
        <div id="breathworkStatus">
            <span>Elapsed Time: <span id="breathworkTimer">00:00</span></span> |
            <span>Rounds Completed: <span id="roundCounter">0</span></span>
        </div>
        <button id="proceedToPhase3Button">Stop Breathwork & Proceed to Phase 3</button>
    </div>
  </div>

  <div id="phase3" class="hidden">
    <h2>Phase 3: Meditation (Observe Thoughts Again)</h2>
    <p>Return your focus to your breath. Note thoughts and classify them as anxious or calm. Click existing thoughts to increment their count.</p>
    <div id="timerPhase3">00:00</div>
    <button id="startTimerPhase3">Start Phase 3</button>
    <button id="stopTimerPhase3" class="hidden">End Phase 3 & See Results</button>
    <hr>
     <div>
        <input type="text" id="thoughtInputPhase3" placeholder="Enter thought (3 words max)" disabled>
        <button id="addAnxiousThoughtPhase3" class="add-thought-btn-anxious" disabled>Add Anxious</button>
        <button id="addCalmThoughtPhase3" class="add-thought-btn-calm" disabled>Add Calm</button>
    </div>
    <ul id="thoughtListPhase3"></ul>
  </div>

  <div id="results" class="hidden">
    <h2>Results Comparison</h2>
    <p>Here's a comparison of the thoughts noted before and after the breathwork:</p>
    <div id="sentimentAnalysis">
        <h3>Sentiment Breakdown</h3>
        <div id="sentimentPhase1"></div>
        <hr style="margin: 15px 0;">
        <div id="sentimentPhase3"></div>
    </div>
    <div id="comparison">
        <h3 style="text-align:center; margin-top: 20px;">Thought Frequency</h3>
        </div>
    <button id="startOver">Start Over</button>
  </div>

  <script>
    // --- Phase 1 Variables ---
    const phase1Div = document.getElementById('phase1');
    const durationInput = document.getElementById('meditationDuration');
    const timerDisplay = document.getElementById('timer');
    const startTimerButton = document.getElementById('startTimer');
    const stopTimerButton = document.getElementById('stopTimer');
    const thoughtInput = document.getElementById('thoughtInput');
    // NEW: Buttons for adding thoughts
    const addAnxiousThoughtButton = document.getElementById('addAnxiousThought');
    const addCalmThoughtButton = document.getElementById('addCalmThought');
    const thoughtList = document.getElementById('thoughtList');
    // UPDATED: Data structure stores { count: number, sentiment: 'anxious' | 'calm' }
    let thoughtsPhase1 = {};
    let timerInterval;
    let secondsRemaining;
    let phase1Duration = 0;

    // --- Phase 2 Variables ---
    const phase2Div = document.getElementById('phase2');
    const breathworkOptionsDiv = document.getElementById('breathworkOptions');
    const breathworkActiveDiv = document.getElementById('breathworkActive');
    const breathworkGuideDiv = document.getElementById('breathworkGuide');
    const breathworkTimerDisplay = document.getElementById('breathworkTimer');
    const roundCounterDisplay = document.getElementById('roundCounter');
    const skipBreathworkDirectlyButton = document.getElementById('skipBreathworkDirectly');
    const proceedToPhase3Button = document.getElementById('proceedToPhase3Button');
    let breathInterval;
    let breathworkElapsedInterval;
    let breathworkRoundCount = 0;
    let breathworkElapsedTime = 0;

    // --- Phase 3 Variables ---
    const phase3Div = document.getElementById('phase3');
    const timerDisplayPhase3 = document.getElementById('timerPhase3');
    const startTimerPhase3Button = document.getElementById('startTimerPhase3');
    const stopTimerPhase3Button = document.getElementById('stopTimerPhase3');
    const thoughtInputPhase3 = document.getElementById('thoughtInputPhase3');
    // NEW: Buttons for adding thoughts
    const addAnxiousThoughtPhase3Button = document.getElementById('addAnxiousThoughtPhase3');
    const addCalmThoughtPhase3Button = document.getElementById('addCalmThoughtPhase3');
    const thoughtListPhase3 = document.getElementById('thoughtListPhase3');
    // UPDATED: Data structure
    let thoughtsPhase3 = {};
    let timerIntervalPhase3;
    let secondsRemainingPhase3;

    // --- Results Variables ---
    const resultsDiv = document.getElementById('results');
    const comparisonDiv = document.getElementById('comparison'); // For the table
    const sentimentAnalysisDiv = document.getElementById('sentimentAnalysis'); // For percentages
    const sentimentPhase1Div = document.getElementById('sentimentPhase1');
    const sentimentPhase3Div = document.getElementById('sentimentPhase3');
    const startOverButton = document.getElementById('startOver');

    // --- Utility Functions ---
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = seconds % 60;
      return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // UPDATED: Function to draw the list based on the new data structure
    function updateThoughtList(listElement, thoughtsObject) {
        listElement.innerHTML = ''; // Clear the list
        // Sort by count descending
        const sortedThoughts = Object.entries(thoughtsObject).sort(([,a],[,b]) => b.count - a.count);

        for (const [thought, data] of sortedThoughts) {
            const listItem = document.createElement('li');
            listItem.textContent = thought; // Just the text
            listItem.classList.add(data.sentiment); // Add 'anxious' or 'calm' class for styling

            const countSpan = document.createElement('span');
            countSpan.className = 'count';
            countSpan.textContent = data.count; // Get count from data object
            listItem.appendChild(countSpan);

            // Add event listener to increment count on click
             listItem.addEventListener('click', () => {
                 thoughtsObject[thought].count++; // Increment count in the object
                 updateThoughtList(listElement, thoughtsObject); // Redraw the list
             });

            listElement.appendChild(listItem);
        }
    }

    // UPDATED: Function to add a thought with sentiment
    function addThoughtToList(thoughtText, thoughtsObject, listElement, sentiment) {
        const cleanedThought = thoughtText.trim().toLowerCase(); // Normalize
        if (cleanedThought.split(' ').length <= 3 && cleanedThought !== '') {
            if (!thoughtsObject[cleanedThought]) {
                // Add new thought with count 1 and specified sentiment
                thoughtsObject[cleanedThought] = { count: 1, sentiment: sentiment };
            } else {
                // If thought exists, clicking list item increments count.
                // Adding via button maybe shouldn't automatically increment?
                // Or maybe alert user it exists already? Let's alert for now.
                 alert(`'${cleanedThought}' already logged. Click it in the list to increment count.`);
                 return false; // Indicate not added/updated via this button press
                // Alternatively: Just increment count here too?
                // thoughtsObject[cleanedThought].count++;
            }
            updateThoughtList(listElement, thoughtsObject);
            return true; // Indicate success
        }
         if (cleanedThought !== '') {
            alert("Thought must be 3 words or less.");
         }
        return false; // Indicate failure
    }


    // --- Phase 1 Logic ---
    startTimerButton.addEventListener('click', () => {
        phase1Duration = parseInt(durationInput.value) * 60;
        if (isNaN(phase1Duration) || phase1Duration <= 0) {
            alert("Please enter a valid duration (1-60 minutes).");
            return;
        }
        secondsRemaining = phase1Duration;
        timerDisplay.textContent = formatTime(secondsRemaining);

        startTimerButton.classList.add('hidden');
        stopTimerButton.classList.remove('hidden');
        durationInput.disabled = true;
        thoughtInput.disabled = false;
        // Enable add buttons
        addAnxiousThoughtButton.disabled = false;
        addCalmThoughtButton.disabled = false;

        timerInterval = setInterval(() => {
            secondsRemaining--;
            timerDisplay.textContent = formatTime(secondsRemaining);
            if (secondsRemaining <= 0) {
                stopPhase1();
            }
        }, 1000);
    });

    // Event listeners for the new add buttons
    addAnxiousThoughtButton.addEventListener('click', () => {
         if (addThoughtToList(thoughtInput.value, thoughtsPhase1, thoughtList, 'anxious')) {
           thoughtInput.value = ''; // Clear input on success
        }
    });
    addCalmThoughtButton.addEventListener('click', () => {
         if (addThoughtToList(thoughtInput.value, thoughtsPhase1, thoughtList, 'calm')) {
           thoughtInput.value = ''; // Clear input on success
        }
    });

    // Optional: Allow Enter key press after typing to add (maybe default to anxious or require button click?)
    // For simplicity, let's require button clicks for sentiment.
    // thoughtInput.addEventListener('keypress', function (e) { ... }); // Removed Enter key listener

    stopTimerButton.addEventListener('click', stopPhase1);

    function stopPhase1() {
        clearInterval(timerInterval);
        timerDisplay.textContent = "Finished";
        thoughtInput.disabled = true;
        addAnxiousThoughtButton.disabled = true; // Disable add buttons
        addCalmThoughtButton.disabled = true;
        stopTimerButton.classList.add('hidden');

        phase1Div.classList.add('hidden');
        phase2Div.classList.remove('hidden');
        breathworkOptionsDiv.classList.remove('hidden');
        breathworkActiveDiv.classList.add('hidden');
    }


    // --- Phase 2 Logic (Unchanged from previous version) ---
    breathworkOptionsDiv.addEventListener('click', (e) => {
        if (e.target.classList.contains('breathworkBtn')) {
            const type = e.target.dataset.type;
            startBreathwork(type);
        } else if (e.target.id === 'skipBreathworkDirectly') {
            proceedToPhase3();
        }
    });

    proceedToPhase3Button.addEventListener('click', () => {
        stopBreathwork();
        proceedToPhase3();
    });

    function startBreathwork(type) {
        breathworkOptionsDiv.classList.add('hidden');
        breathworkActiveDiv.classList.remove('hidden');

        clearInterval(breathInterval);
        clearTimeout(breathInterval);
        clearInterval(breathworkElapsedInterval);
        breathworkRoundCount = 0;
        breathworkElapsedTime = 0;
        roundCounterDisplay.textContent = breathworkRoundCount;
        breathworkTimerDisplay.textContent = formatTime(breathworkElapsedTime);

        breathworkElapsedInterval = setInterval(() => {
             breathworkElapsedTime++;
             breathworkTimerDisplay.textContent = formatTime(breathworkElapsedTime);
        }, 1000);

        let step = 0;
        let instructions = [];
        let durations = [];

        if (type === 'box') {
            instructions = ['Inhale (4s)...', 'Hold (4s)...', 'Exhale (4s)...', 'Hold (4s)...'];
            durations = [4000, 4000, 4000, 4000];
        } else if (type === '478') {
            instructions = ['Inhale (4s)...', 'Hold (7s)...', 'Exhale (8s)...', "Pause (1s)..."];
            durations = [4000, 7000, 8000, 1000];
        }

        const totalCycleSteps = instructions.length;

        function updateGuidance() {
            const currentStepIndex = step % totalCycleSteps;
            breathworkGuideDiv.textContent = instructions[currentStepIndex];

            if (currentStepIndex === totalCycleSteps - 1) {
                breathworkRoundCount++;
                roundCounterDisplay.textContent = breathworkRoundCount;
            }
            breathInterval = setTimeout(updateGuidance, durations[currentStepIndex]);
            step++;
        }
        updateGuidance();
    }

    function stopBreathwork() {
         clearTimeout(breathInterval);
         clearInterval(breathworkElapsedInterval);
         breathworkGuideDiv.textContent = 'Stopped';
    }

    function proceedToPhase3() {
        stopBreathwork();
        phase2Div.classList.add('hidden');
        phase3Div.classList.remove('hidden');
        secondsRemainingPhase3 = phase1Duration;
         if (secondsRemainingPhase3 <= 0) {
             console.warn("Phase 1 duration not set, defaulting Phase 3 to 2 minutes.");
             secondsRemainingPhase3 = 120;
         }
        timerDisplayPhase3.textContent = formatTime(secondsRemainingPhase3);

        startTimerPhase3Button.classList.remove('hidden');
        stopTimerPhase3Button.classList.add('hidden');
        thoughtInputPhase3.disabled = true;
        addAnxiousThoughtPhase3Button.disabled = true; // Ensure buttons start disabled
        addCalmThoughtPhase3Button.disabled = true;
        thoughtListPhase3.innerHTML = ''; // Clear phase 3 list
        thoughtsPhase3 = {}; // Clear phase 3 thoughts object
    }


    // --- Phase 3 Logic ---
     startTimerPhase3Button.addEventListener('click', () => {
        if (secondsRemainingPhase3 <= 0) {
             alert("Phase 3 duration issue. Please start over.");
             return;
        }
        startTimerPhase3Button.classList.add('hidden');
        stopTimerPhase3Button.classList.remove('hidden');
        thoughtInputPhase3.disabled = false;
        // Enable add buttons
        addAnxiousThoughtPhase3Button.disabled = false;
        addCalmThoughtPhase3Button.disabled = false;


        timerIntervalPhase3 = setInterval(() => {
            secondsRemainingPhase3--;
            timerDisplayPhase3.textContent = formatTime(secondsRemainingPhase3);
            if (secondsRemainingPhase3 <= 0) {
                stopPhase3();
            }
        }, 1000);
    });

    // Event listeners for phase 3 add buttons
     addAnxiousThoughtPhase3Button.addEventListener('click', () => {
         if (addThoughtToList(thoughtInputPhase3.value, thoughtsPhase3, thoughtListPhase3, 'anxious')) {
            thoughtInputPhase3.value = ''; // Clear input on success
         }
    });
     addCalmThoughtPhase3Button.addEventListener('click', () => {
         if (addThoughtToList(thoughtInputPhase3.value, thoughtsPhase3, thoughtListPhase3, 'calm')) {
            thoughtInputPhase3.value = ''; // Clear input on success
         }
    });


    stopTimerPhase3Button.addEventListener('click', stopPhase3);

    function stopPhase3() {
        clearInterval(timerIntervalPhase3);
        timerDisplayPhase3.textContent = "Finished";
        thoughtInputPhase3.disabled = true;
        addAnxiousThoughtPhase3Button.disabled = true; // Disable add buttons
        addCalmThoughtPhase3Button.disabled = true;
        stopTimerPhase3Button.classList.add('hidden');

        phase3Div.classList.add('hidden');
        resultsDiv.classList.remove('hidden');
        displayResults();
    }

    // --- Results Logic ---
    // UPDATED: Function includes sentiment analysis calculation
    function displayResults() {
        comparisonDiv.innerHTML = ''; // Clear previous frequency table
        sentimentPhase1Div.innerHTML = ''; // Clear previous sentiment analysis
        sentimentPhase3Div.innerHTML = '';

        const allThoughts = new Set([...Object.keys(thoughtsPhase1), ...Object.keys(thoughtsPhase3)]);

        let totalCount1 = 0;
        let anxiousCount1 = 0;
        let calmCount1 = 0;
        let totalCount3 = 0;
        let anxiousCount3 = 0;
        let calmCount3 = 0;

        // --- Calculate Sentiment Totals ---
        for (const thought in thoughtsPhase1) {
            const data = thoughtsPhase1[thought];
            totalCount1 += data.count;
            if (data.sentiment === 'anxious') {
                anxiousCount1 += data.count;
            } else if (data.sentiment === 'calm') {
                calmCount1 += data.count;
            }
        }
         for (const thought in thoughtsPhase3) {
            const data = thoughtsPhase3[thought];
            totalCount3 += data.count;
            if (data.sentiment === 'anxious') {
                anxiousCount3 += data.count;
            } else if (data.sentiment === 'calm') {
                calmCount3 += data.count;
            }
        }

        // --- Display Sentiment Percentages ---
        const calculatePercentage = (part, total) => total === 0 ? 0 : ((part / total) * 100).toFixed(1);

        sentimentPhase1Div.innerHTML = `
            <h4>Phase 1 Sentiment</h4>
            <p>Total Thoughts: ${totalCount1}</p>
            <p><span class="sentiment-anxious">Anxious:</span> ${anxiousCount1} (${calculatePercentage(anxiousCount1, totalCount1)}%)</p>
            <p><span class="sentiment-calm">Calm:</span> ${calmCount1} (${calculatePercentage(calmCount1, totalCount1)}%)</p>
        `;
         sentimentPhase3Div.innerHTML = `
            <h4>Phase 3 Sentiment</h4>
            <p>Total Thoughts: ${totalCount3}</p>
            <p><span class="sentiment-anxious">Anxious:</span> ${anxiousCount3} (${calculatePercentage(anxiousCount3, totalCount3)}%)</p>
            <p><span class="sentiment-calm">Calm:</span> ${calmCount3} (${calculatePercentage(calmCount3, totalCount3)}%)</p>
        `;


        // --- Display Frequency Table ---
         comparisonDiv.innerHTML = '<h3 style="text-align:center; margin-top: 20px;">Thought Frequency</h3>'; // Add header back

        if (allThoughts.size === 0) {
            comparisonDiv.innerHTML += "<p>No thoughts were logged in either phase.</p>";
             // Also update sentiment analysis text if needed
             sentimentPhase1Div.innerHTML += "<p>(No thoughts logged)</p>";
             sentimentPhase3Div.innerHTML += "<p>(No thoughts logged)</p>";
            return; // Don't draw table if no thoughts
        }

        const table = document.createElement('table');
        table.innerHTML = `
            <thead>
                <tr>
                    <th>Thought</th>
                    <th>Sentiment</th>
                    <th>Phase 1 Count</th>
                    <th>Phase 3 Count</th>
                    <th>Change</th>
                </tr>
            </thead>
            <tbody></tbody>`;
        const tbody = table.querySelector('tbody');

        const sortedAllThoughts = Array.from(allThoughts).sort();

        sortedAllThoughts.forEach(thought => {
            const data1 = thoughtsPhase1[thought] || { count: 0, sentiment: '-' }; // Default if not in phase 1
            const data3 = thoughtsPhase3[thought] || { count: 0, sentiment: '-' }; // Default if not in phase 3
            // Determine sentiment to display (prefer phase 1's if available, else phase 3's, else '-')
            const sentimentDisplay = data1.sentiment !== '-' ? data1.sentiment : data3.sentiment;

            const count1 = data1.count;
            const count3 = data3.count;
            const change = count3 - count1;
            let changeText = change === 0 ? '-' : (change > 0 ? `+${change}` : `${change}`);
            let changeClass = change === 0 ? '' : (change > 0 ? 'increase' : 'decrease');

            const row = document.createElement('tr');
             // Add class to row based on sentiment for potential styling
             if (sentimentDisplay !== '-') row.classList.add(sentimentDisplay);

            row.innerHTML = `
                <td>${thought}</td>
                <td>${sentimentDisplay}</td>
                <td>${count1}</td>
                <td>${count3}</td>
                <td class="${changeClass}">${changeText}</td>
            `;
            tbody.appendChild(row);
        });

        comparisonDiv.appendChild(table);
    }

     // --- Start Over Logic ---
     startOverButton.addEventListener('click', () => {
         thoughtsPhase1 = {};
         thoughtsPhase3 = {};
         clearInterval(timerInterval);
         clearInterval(timerIntervalPhase3);
         stopBreathwork();

         thoughtList.innerHTML = '';
         thoughtListPhase3.innerHTML = '';
         comparisonDiv.innerHTML = ''; // Clear table area
         sentimentPhase1Div.innerHTML = ''; // Clear sentiment area 1
         sentimentPhase3Div.innerHTML = ''; // Clear sentiment area 3
         sentimentAnalysisDiv.classList.remove('hidden'); // Ensure sentiment area wrapper is visible if results were shown


         timerDisplay.textContent = "00:00";
         timerDisplayPhase3.textContent = "00:00";
         breathworkTimerDisplay.textContent = "00:00";
         roundCounterDisplay.textContent = "0";
         durationInput.disabled = false;
         durationInput.value = "2";
         thoughtInput.value = '';
         thoughtInputPhase3.value = '';

         phase1Div.classList.remove('hidden');
         phase2Div.classList.add('hidden');
         phase3Div.classList.add('hidden');
         resultsDiv.classList.add('hidden');
         breathworkOptionsDiv.classList.remove('hidden');
         breathworkActiveDiv.classList.add('hidden');

         startTimerButton.classList.remove('hidden');
         stopTimerButton.classList.add('hidden');
         startTimerPhase3Button.classList.remove('hidden');
         stopTimerPhase3Button.classList.add('hidden');

         thoughtInput.disabled = true;
         addAnxiousThoughtButton.disabled = true;
         addCalmThoughtButton.disabled = true;
         thoughtInputPhase3.disabled = true;
         addAnxiousThoughtPhase3Button.disabled = true;
         addCalmThoughtPhase3Button.disabled = true;
     });

  </script>

</body>
</html>
